/*! pie-chart - v1.0.0 - 2015-08-13
=======
* https://github.com/n3-charts/pie-chart
* Copyright (c) 2015 n3-charts  Licensed ,  */
!function(){"use strict";function a(a,b,c){function d(d,e,f,g){var h,i,j=a.getDefaultMargins(),k=function(a){a.width=e[0].parentElement.offsetWidth||900,a.height=e[0].parentElement.offsetHeight||500},l=function(b,c){a.updatePaths(h,b,j,c).updateLegend(h,b,j,c)},m=function(b,c){a.clean(e[0]),k(j),n(b,c,j)},n=function(b,c,d){b&&c&&(c=a.sanitizeOptions(c),h=a.bootstrap(e[0],d),a.draw(h).updatePaths(h,b,d,c).addLegend(h).updateLegend(h,b,d,c))},o=function(){var b=a.addDataForGauge(d.data,d.options);a.clean(e[0]),k(j),h=a.bootstrap(e[0],j),a.draw(h).updatePaths(h,b,j,d.options).addLegend(h).updateLegend(h,b,j,d.options)},p=function(){return i&&b.cancel(i),i=b(o,1)};c.addEventListener("resize",p),d.$watch("data",function(b,c){b=a.addDataForGauge(b,d.options),h?l(b,d.options):m(b,d.options)},!0),d.$watch("options",function(b){var c=a.addDataForGauge(d.data,b);m(c,b)},!0)}var e={replace:!0,restrict:"E",scope:{data:"=",options:"="},template:"<div></div>",link:d};return e}angular.module("n3-pie-chart",["n3-pie-utils"]).directive("pieChart",a),a.$inject=["$utils","$timeout","$window"]}(),angular.module("n3-pie-utils",[]).factory("$utils",[function(){return{draw:function(a){return a.append("g").attr({id:"n3-pie-arcs"}),this},updatePaths:function(a,b,c,d){var e=this.getTools(c,d),f=function(a){var b=this.__current?this.__current:{startAngle:a.startAngle,endAngle:a.startAngle},c={startAngle:a.startAngle,endAngle:a.endAngle},d=d3.interpolate(b,c);return function(a){return e.arc(d(a))}},g=a.selectAll("#n3-pie-arcs").selectAll(".arc").data(e.pie(b),function(a){return a.data.label});return g.enter().append("path").attr({"class":"arc",id:function(a,b){return"arc_"+b}}).style({fill:function(a){return a.data.color},"fill-opacity":.8}),g.transition().duration(250).attrTween("d",f).each("end",function(a){this.__current={startAngle:a.startAngle,endAngle:a.endAngle}}),g.exit().remove(),this},getTools:function(a,b){var c=this.getRadius(a),d=Math.max(c-b.thickness,0),e=d3.svg.arc().outerRadius(c).innerRadius(d),f=d3.layout.pie().value(function(a){return a.value});return"gauge"===b.mode&&f.sort(null),{pie:f,arc:e}},addLegend:function(a){a.append("g").attr("id","n3-pie-legend");return this},updateLegend:function(a,b,c,d){return"gauge"===d.mode?this.updateGaugeLegend(a,b,c,d):this.updateRegularLegend(a,b,c,d),this},updateRegularLegend:function(a,b,c,d){var e=this.getRadius(c),f=e-d.thickness,g=b.length*f/10,h=d3.scale.linear().range([-g,g]).domain([0,b.length-1]).nice(),i=a.selectAll("#n3-pie-legend").selectAll(".legend-item").data(b,function(a){return a.label});i.enter().append("text").classed("legend-item",!0).on("mouseover",this.onMouseOver(a)).on("mouseout",this.onMouseOut(a)),i.text(this.getLegendLabelFunction(f)).attr({"text-anchor":"middle",transform:function(a,b){return"translate(0, "+h(b)+")"}}).style({"font-family":"monospace","font-size":Math.max(12,f/10)+"px",fill:function(a){return a.color},"fill-opacity":.8}),i.exit().remove()},updateGaugeLegend:function(a,b,c,d){var e=(this.getRadius(c)-d.thickness)/2;if(!(0>e)){var f=a.selectAll("#n3-pie-legend"),g=f.selectAll(".legend-title").data(b.filter(function(a){return!a.__isComplement}));g.enter().append("text").attr({"class":"legend-title","text-anchor":"middle",y:-e/4+"px"}).style({"font-size":Math.max(e/2,12)+"px",fill:function(a){return a.color},"fill-opacity":.8}),g.text(function(a){return a.label}),g.exit().remove();var h=f.selectAll(".legend-value").data(b.filter(function(a){return!a.__isComplement}));h.enter().append("text").attr({"class":"legend-value","text-anchor":"middle",y:e/1.5+"px"}).style({"font-size":e+"px",fill:function(a){return a.color},"fill-opacity":.8}),h.text(function(a){return a.value+(a.suffix||"")}),h.exit().remove()}},getLegendLabelFunction:function(a){var b=this;return function(c,d){return 40>a?"":100>a?c.label:b.getLegendLabel(c.label,c.value,20)}},onMouseOver:function(a){return function(b,c){var d=function(a){return a.transition().duration(50).style({opacity:function(a,b){return b===c?"1":"0.4"}})};d(a.selectAll(".legend-item")),d(a.selectAll(".arc"))}},onMouseOut:function(a){return function(b,c){var d=function(a){return a.transition().duration(50).style({opacity:1})};d(a.selectAll(".legend-item")),d(a.selectAll(".arc"))}},getLegendLabel:function(a,b,c){for(var d=[],e=0;c>e;e++)d.push(".");return a+=" ",b=" "+b,a.split("").forEach(function(a,b){d[b]=a}),b.split("").forEach(function(a,e){d[c-b.length+e]=a}),d.join("")},increase_brightness:function(a,b){a=a.replace(/^\s*#|\s*$/g,""),3==a.length&&(a=a.replace(/(.)/g,"$1$1"));var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return"#"+(0|256+c+(256-c)*b/100).toString(16).substr(1)+(0|256+d+(256-d)*b/100).toString(16).substr(1)+(0|256+e+(256-e)*b/100).toString(16).substr(1)},addDataForGauge:function(a,b){if(!b||"gauge"!==b.mode||1!==a.length)return a;a=a.concat();var c="white";return a[0].hasOwnProperty("complementBrightness")?c=this.increase_brightness(a[0].color,a[0].complementBrightness):a[0].hasOwnProperty("colorComplement")&&(c=a[0].colorComplement),a.push({value:b.total-a[0].value,color:c,__isComplement:!0}),a},getDefaultMargins:function(){return{top:10,right:10,bottom:10,left:10}},clean:function(a){d3.select(a).select("svg").remove()},bootstrap:function(a,b){d3.select(a).classed("chart",!0);var c=b.width,d=b.height,e=d3.select(a).append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+.5*b.width+","+.5*b.height+")");return e},getRadius:function(a){var b=a;return.5*Math.min(b.width-b.left-b.right,b.height-b.top-b.bottom)},looksLikeSameSeries:function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++){if(b[c].label!==a[c].label)return!1;if(b[c].color!==a[c].color)return!1}return!0},sanitizeOptions:function(a){return void 0===a.thickness?a.thickness=20:a.thickness=parseInt(a.thickness),"gauge"===a.mode&&this.sanitizeGaugeOptions(a),a},sanitizeGaugeOptions:function(a){void 0===a.total?a.total=100:a.total=parseInt(a.total)}}}]);
